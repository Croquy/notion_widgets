<!-- original : https://codepen.io/SeanNorton/pen/LWBXQL -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy"
      content="upgrade-insecure-requests">
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous" />
    <link href="style.css" rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css?family=Lobster|Roboto:400,700"
      rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Oooh+Baby&display=swap"
      rel="stylesheet" />
      <link href="calculator.html" rel="import" />
    <style>
      body {
        line-height: 1.6;
        font-family: "Oooh Baby" !important;
        align-items: center;
  background: radial-gradient(ellipse at center, rgba(255,179,206,0) 0%, rgba(255,180,199,0) 43%, rgba(255,181,189,0.43) 100%)  !important;
  background-attachment: fixed;
  background-repeat: no-repeat;
  display: flex;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00ffb3ce', endColorstr='#6effb5bd', GradientType=1);
  flex-direction: column; 
  height: 100vh;
  justify-content: center;
  min-width: 184px;
  overflow-x: hidden;
  transition: background-color .2s;
      }
 
    </style>
  </head>
  <body>
    <div class="container-fluid ">
      <div class="row">
        <div class="col ">
          <div class="cadre h-100">
            <div class="date" id="date"></div>
            <div class="clock">
              <span class="horloge" id="horloge"></span>
              <div class="hand hours" id="aig_h"></div>
              <div class="hand minutes" id="aig_m"></div>
              <div class="hand seconds" id="aig_s"></div>
              <div class="semaine" id="semaine"></div>
              <div class="point"></div>
              <div class="marker">
                <span class="marker__1"></span>
                <span class="marker__2"></span>
                <span class="marker__3"></span>
                <span class="marker__4"></span>
              </div>
            </div>
          </div>
        </div>
        <div class="col">
          <a
            class="weatherwidget-io"
            href="https://forecast7.com/fr/45d994d72/villefranche-sur-saone/"
            data-label_1="VILLEFRANCHE-SUR-SAONE"
            data-font="Open Sans"
            data-icons="Climacons Animated"
            data-days="5"
            data-theme="hexellence"
            data-textcolor="#64a9b7"
            data-suncolor="#feffa4"
            data-cloudcolor="#93b8ed">VILLEFRANCHE-SUR-SAONE</a>
        </div>

        <div class="col">
          <div class="cadre h-100">
            <nav>
              <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <button class="nav-link active" id="nav-home-tab"
                  data-bs-toggle="tab" data-bs-target="#nav-home" type="button"
                  role="tab" aria-controls="nav-home" aria-selected="true">Aujourd'hui</button>
                <button class="nav-link" id="nav-profile-tab"
                  data-bs-toggle="tab" data-bs-target="#nav-profile"
                  type="button" role="tab" aria-controls="nav-profile"
                  aria-selected="false">Hebdo</button>
                  <button class="nav-link" id="nav-t3-tab"
                  data-bs-toggle="tab" data-bs-target="#nav-t3"
                  type="button" role="tab" aria-controls="nav-t3"
                  aria-selected="false">test3</button>
                <button class="nav-link" id="nav-contact-tab"
                  data-bs-toggle="tab" data-bs-target="#nav-contact"
                  type="button" role="tab" aria-controls="nav-contact"
                  aria-selected="false">Calc</button>
              </div>
            </nav>
            <div class="tab-content " id="nav-tabContent">
              <div class="tab-pane fade show active" id="nav-home"
                role="tabpanel" aria-labelledby="nav-home-tab"><span id="h_j"></span></div>
                <div class="tab-pane fade show " id="nav-t3"
                role="tabpanel" aria-labelledby="nav-t3-tab"><span id="h_t3"></span></div>
              <div class="tab-pane fade" id="nav-profile" role="tabpanel"
                aria-labelledby="nav-profile-tab"><span id="h_h"><ul id='listhoros'>
                </ul></span></div>
              <div class="tab-pane fade" id="nav-contact" role="tabpanel"
                aria-labelledby="nav-contact-tab">
                <div id="calcul"></div>
              </div></div>
          </div>

        </div>
        <script>
 
    
  
      async function  recupurl(url){
       let response = await fetch(url); 
        if (response.ok) { 
          return await response.json();
        } else {
          console.log("HTTP-Error: " + response.status);
        } 
       } 
      async function remplihoroscope(){
       recupurl("https://kayoo123.github.io/astroo-api/jour.json").then(x => ecrit("h_j",x.vierge)); 
       recupurl("https://us-central1-tf-natal.cloudfunctions.net/horoscopeapi_test?token=mmEUtLATc8w_UNnHuR2&sign=virgo&date=today&nodate")
       .then(  async (horos) =>  { 
        compatibility = await translate(horos.compatibility);
        mood = await translate(horos.mood);
        description = await translate(horos.description);
        horosvar = {
        current_date: horos.current_date,
        compatibility: compatibility,
        lucky_time: horos.lucky_time,
        lucky_number: horos.lucky_number,
        mood: mood,
        color: horos.color,
        description: description
      };console.log(horosvar);return horosvar;})   
      .then(horos =>{
        let    str = `<p >${horos.description}</p> `;
  str += `<ul><li> Compatibilité : ${horos.compatibility} </li>
    <li> Nombre porte bonheur: ${horos.lucky_number} </li>
    <li> Meilleur moment : ${horos.lucky_time} </li>
    <li> Couleur : ${horos.color} </li>
    </ul>`;
        ecrit("h_h",str);
        
      } ) ;
      //.then(horos => translate(horos.description).then(horostrad=>ecrit("h_h",horostrad))) ;
    }  
    var stringToHTML = function (str) {
      var parser = new DOMParser();
      var doc = parser.parseFromString(str, 'text/html');
      return doc.body;
      };
    function horostest3 (){
              var xhr = new XMLHttpRequest();
        xhr.open("GET", "https://cors-anywhere.herokuapp.com/https://www.horoscope.com/fr/horoscopes/general/horoscope-general-daily-today.aspx?sign=6");
        xhr.onreadystatechange = function() {
          if (this.readyState < 4) return;
          if (this.status !== 200) {
              console.log("erreur réseau : " + this.status + " " + this.statusText);
          } else {
            
            const horosrecup = stringToHTML(this.responseText);
            const mainHorDiv = $('.horoscope-content');
            console.log(mainHorDiv); 
          /*  const cheerio = require('cheerio');
            const $ = cheerio.load(responseText); 
        // get the specific content from the classname
            const mainHorDiv = $('.horoscope-content');
    
            console.log(mainHorDiv);*/
            // get the text content and remove the first 3 characters
            const description = mainHorDiv.firstChild.text().slice(2);
            console.log(description);
            ecrit("h_t3",description);
          }
        };
        xhr.send(); 
    }
    
    async function translate(text){
      //console.log(text);
      var sourceLang = 'en';
      var targetLang = 'fr'; 
      var url = "https://translate.googleapis.com/translate_a/single?client=gtx&sl="+ sourceLang + "&tl=" + targetLang + "&dt=t&q=" + encodeURI(text); 
      //console.log(url);
      const resp = await fetch(url);
      var retourtableau = await resp.json();
      var retour = "";
      retourtableau[0].forEach(i=> retour+=i[0]);
      return  retour; 
    }
    function ecrit(nom, json) {document.getElementById(nom).innerHTML = json;}
    const calcul = document.getElementById("calcul");
    calcul.innerText=document.getElementById("calculatormain"); 
 
      const span_h = document.getElementById("aig_h");
      const span_m = document.getElementById("aig_m");
      const span_s = document.getElementById("aig_s");
      const span_horloge = document.getElementById("horloge");
      const span_date = document.getElementById("date");
      const options = {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
      };
      function clock() {
        var today = new Date();
        hrs = today.getHours();
        if (hrs < 12) greet = "Bonjour";
        else if (hrs >= 12 && hrs <= 17) greet = "Bon après midi ";
        else if (hrs >= 17 && hrs <= 24) greet = "Bonne soirée  ";
        span_date.innerHTML =
          greet +
          " nous sommes le " +
          today.toLocaleDateString("fr-FR", options);
        span_horloge.innerText =
          zeros(today.getHours()) +
          ":" +
          zeros(today.getMinutes()) +
          ":" +
          zeros(today.getSeconds());
        var h = ((today.getHours() % 12) + today.getMinutes() / 59) * 30; // 22 % 12 = 10pm
        span_h.style.transform = `rotate(${h}deg)`;
        span_m.style.transform = "rotate(" + today.getMinutes() * 6 + "deg)";
        span_s.style.transform = "rotate(" + today.getSeconds() * 6 + "deg)";
      }
      function currentWeek(){
        currentDate = new Date();
        startDate = new Date(currentDate.getFullYear(), 0, 1);
        var days = Math.floor((currentDate - startDate) /
            (24 * 60 * 60 * 1000)); 
        document.getElementById("semaine").innerHTML= "S"+Math.ceil(days / 7);
    }
      // adds zero infront of single digit number
      function zeros(num) {
        if (num < 10) {
          num = "0" + num;
        }
        return num;
      }

      function dateTime() {
        clock();
        currentWeek();
        setTimeout(dateTime, 500);
      }

      dateTime();
      remplihoroscope();
      horostest3 ();
      // END
    </script>
        <!-- forcast -->
        <script>
      !(function (d, s, id) {
        var js,
          fjs = d.getElementsByTagName(s)[0];
        if (!d.getElementById(id)) {
          js = d.createElement(s);
          js.id = id;
          js.src = "https://weatherwidget.io/js/widget.min.js";
          fjs.parentNode.insertBefore(js, fjs);
        }
      })(document, "script", "weatherwidget-io-js");
    </script>
        <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
          crossorigin="anonymous"></script>
      </body>
    </html>
